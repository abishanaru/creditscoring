---
title: "Credit Scoring SBD2"
author: "Abishan Arumugavel, Vladyslav Gorbunov, Gilles Nikles"
date: "2023-10-10"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Used librarys
```{r}
library(readr)
library(dplyr)
library(caret)
library(DescTools)
library(pROC)
library(ROCR)
```


## Import dataset
```{r}
loan_sample <- read_csv("loan_sample_8.csv")
```


## Excercise 1

### Describe the data. Specifically:

– Check and report the structure of the data set.
– How many numeric and how many categorical variables are included in the data? What categorical variable has the most levels in it?
– Summarize the variables. Discuss the summary statistics obtained.
– Check the levels of the target variable by choosing the appropriate visualization. Is the target variable balanced?
– Check the distribution of the numeric variables in the data set (include different visual representations).



• Investigating outliers with a box plot
Elaborate your view on how to proceed in dealing with the outliers and – if necessary – take appropriate action.
```{r}


```

• Investigating the distribution of the numeric features per the two levels of our target feature
(i.e. default vs non-default). Discuss the visualizations. Which variables seem to be relevant in predicting the target feature?
```{r}


```

• Use a bar plot visualization to investigate the associations between the categorical variables and the target feature.
```{r}


```

• Visualize the correlations that emerge between the numerical features. Discuss the results. Which variables are highly correlated? Decide whether you keep all variables.
```{r}


```

• Plot an interactive scatter plot of the association between the loan amount requested and the annual income of the borrower. Discuss the plot. What can you tell about the association?
```{r}


```

• Create a new balanced data set where the two levels of the target variable will be equally represented; Create a bar plot of the newly created target variable. Why is this step necessary?
```{r}


```


## Excercise 2
• Train and test a logistic classifier. Specifically:
– Divide the sample into training and testingset using 70% for training the algorithm. – Train the classifier and report the coefficients obtained and interpret the results. – Plot the ROC and the Precision/Recall Curve and interpret the results.
– Produce the confusion matrix and interpret the results.
– Report the AUC values and the overall accuracy and interpret the results.
```{r}
# Create a copy of original data
loan_data <- loan_sample
```


```{r}
# Set random seed to make results reproducible
set.seed(5)

# Split the data into training(70%) and testing(30%) data sets.
splitIndex <- createDataPartition(y = loan_data$Status, p = 0.7, list = FALSE)

# Training data (70%)
train_data <- loan_data[splitIndex, ]
# Checking if the data distribution in the train_data
PercTable(train_data$Status)

# Testing data (30%)
test_data <- loan_data[-splitIndex, ]
# Checking if the data distribution in the test_data
PercTable(test_data$Status)

# Train a logistic regression model (all variables as input)
model <- glm(Status ~ ., data = train_data, family = "binomial")

# Display the coefficients
summary(model)

# Predict probabilities on the test set
predictions_prob <- predict(model, type = "response", newdata = test_data)

# ROC curve using pROC
roc_obj <- roc(test_data$Status, predictions_prob)
plot(roc_obj, main="ROC Curve")
auc(roc_obj)

# Precision-Recall Curve using ROCR
pred_obj <- prediction(predictions_prob, test_data$Status)
pr <- performance(pred_obj, measure="prec", x.measure="rec")
plot(pr, main="Precision-Recall Curve")

# Confusion matrix
predictions_class <- ifelse(predictions_prob > 0.5, 1, 0)
cm <- confusionMatrix(as.factor(predictions_class), as.factor(test_data$Status))
print(cm)

# Overall accuracy
accuracy <- sum(diag(cm$table)) / sum(cm$table)
print(paste("Overall Accuracy: ", accuracy))
```
# Excercise 3
Habe bereits versucht mit factors die accuracy des Models zu verbessern. Hat jedoch keinen Einfluss.
Mann könnte einen kurzen Text darüber schreiben und erklären, dass wir es versucht haben.

# Convert categorical variables to factors
loan_data$grade <- as.factor(loan_data$grade)
loan_data$home_ownership <- as.factor(loan_data$home_ownership)
loan_data$verification_status <- as.factor(loan_data$verification_status)
loan_data$purpose <- as.factor(loan_data$purpose)
loan_data$application_type <- as.factor(loan_data$application_type)
